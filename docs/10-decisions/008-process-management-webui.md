---
depends_on:
  - ./007-five-layer-architecture.md
tags: [decisions, adr, process-management, webui, cross-platform]
ai_summary: "5å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã‚’Node.js + Web UIã§å®Ÿç¾ã—ã€OSéä¾å­˜ã‚’é”æˆ"
---

# ADR-008: ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã¨Web UIå¯è¦–åŒ–

> Status: Accepted
> æœ€çµ‚æ›´æ–°: 2026-01-29

## ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

ADR-007ã§5å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆShogun/Planner/Supervisor/Worker/Reviewerï¼‰ã‚’æ¡ç”¨ã—ãŸã€‚ã“ã‚Œã‚‰ã®å±¤ã¯è¤‡æ•°ã®AIãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã€‚

### èª²é¡Œ

| èª²é¡Œ | èª¬æ˜ |
|------|------|
| ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç† | 5ã¤ã®AIãƒ—ãƒ­ã‚»ã‚¹ã‚’èª°ãŒã©ã†èµ·å‹•ãƒ»ç®¡ç†ã™ã‚‹ã‹ |
| å¯è¦–åŒ– | å„å±¤ã®çŠ¶æ…‹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèªã—ãŸã„ |
| OSä¾å­˜ | tmuxã¯Linux/macOS/WSL2é™å®šã€Windows nativeã§å‹•ã‹ãªã„ |

### æ¤œè¨ã—ãŸé¸æŠè‚¢

| æ¡ˆ | ä»•çµ„ã¿ | OSéä¾å­˜ | å¯è¦–åŒ– |
|----|--------|---------|--------|
| tmux | ã‚·ã‚§ãƒ«ãŒtmuxã§ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç† | âŒ | ã‚¿ãƒ¼ãƒŸãƒŠãƒ« |
| Node.js + Web UI | AgentMineãŒãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã€Web UIã§å¯è¦–åŒ– | âœ… | ãƒ–ãƒ©ã‚¦ã‚¶ |
| Dockerå†…tmux | ã‚³ãƒ³ãƒ†ãƒŠå†…ã§tmux | âœ… | ã‚¿ãƒ¼ãƒŸãƒŠãƒ« |

## æ±ºå®šäº‹é …

### Node.js + Web UIæ–¹å¼ã®æ¡ç”¨

AgentMineãŒNode.jsã®`child_process`ã§AIãƒ—ãƒ­ã‚»ã‚¹ã‚’ç®¡ç†ã—ã€Web UIã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯è¦–åŒ–ã™ã‚‹ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆWeb UIï¼‰                              â”‚
â”‚  - å„å±¤ã®å‡ºåŠ›ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º                   â”‚
â”‚  - ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ã®å¯è¦–åŒ–                            â”‚
â”‚  - å…¥åŠ›é€ä¿¡                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†‘ WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AgentMine daemon                               â”‚
â”‚  - ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ï¼ˆchild_processï¼‰                 â”‚
â”‚  - stdout/stderr ã‚­ãƒ£ãƒ—ãƒãƒ£                     â”‚
â”‚  - WebSocketé…ä¿¡                                â”‚
â”‚  - ã‚¿ã‚¹ã‚¯/çŠ¶æ…‹ç®¡ç†ï¼ˆDBï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ spawn
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIãƒ—ãƒ­ã‚»ã‚¹ç¾¤                                    â”‚
â”‚  - Shogunï¼ˆClaude Codeï¼‰                        â”‚
â”‚  - Plannerï¼ˆClaude Codeï¼‰                       â”‚
â”‚  - Supervisorï¼ˆClaude Codeï¼‰                    â”‚
â”‚  - Worker 1..Nï¼ˆClaude Codeï¼‰                   â”‚
â”‚  - Reviewerï¼ˆClaude Codeï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Web UIãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AgentMine - Session: auth-feature                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Shogun] [Planner] [Supervisor] [Workers â–¼] [Reviewer]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Shogun                                            [å…¥åŠ› â–¼] â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  > èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„                                â”‚
â”‚  < äº†è§£ã—ã¾ã—ãŸã€‚Plannerã«ã‚¿ã‚¹ã‚¯åˆ†è§£ã‚’ä¾é ¼ã—ã¾ã™ã€‚            â”‚
â”‚  < Plannerå®Œäº†: 3ã‚¿ã‚¹ã‚¯ã«åˆ†è§£ã•ã‚Œã¾ã—ãŸ                      â”‚
â”‚  < Supervisor: Workerèµ·å‹•ä¸­ (1/3)                           â”‚
â”‚  ...                                                        â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã‚¿ã‚¹ã‚¯çŠ¶æ³                                                  â”‚
â”‚  #1 èªè¨¼æ©Ÿèƒ½ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 2/3 å®Œäº†                            â”‚
â”‚    â”œâ”€ #1-1 DBã‚¹ã‚­ãƒ¼ãƒ âœ…                                    â”‚
â”‚    â”œâ”€ #1-2 APIå®Ÿè£… ğŸ”„ Worker-2                              â”‚
â”‚    â””â”€ #1-3 UIå®Ÿè£… â³ blocked by #1-2                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†API

```typescript
// packages/core/src/services/process-manager.ts

interface ProcessManager {
  // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
  createSession(config: SessionConfig): Promise<Session>
  destroySession(sessionId: string): Promise<void>

  // ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†
  spawnProcess(session: Session, role: Role, command: string[]): Process
  killProcess(processId: string): Promise<void>

  // å…¥å‡ºåŠ›
  sendInput(processId: string, text: string): void
  onOutput(processId: string, callback: (data: OutputEvent) => void): void

  // çŠ¶æ…‹
  getProcessStatus(processId: string): ProcessStatus
  listProcesses(sessionId: string): Process[]
}

interface OutputEvent {
  processId: string
  stream: 'stdout' | 'stderr'
  data: string
  timestamp: Date
}
```

### WebSocket API

```typescript
// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ ã‚µãƒ¼ãƒãƒ¼
interface ClientMessage {
  type: 'subscribe' | 'unsubscribe' | 'input'
  sessionId?: string
  processId?: string
  text?: string
}

// ã‚µãƒ¼ãƒãƒ¼ â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
interface ServerMessage {
  type: 'output' | 'status' | 'task_update'
  processId?: string
  data: any
  timestamp: Date
}
```

### CLIã‚³ãƒãƒ³ãƒ‰

```bash
# ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆdaemonã‚‚èµ·å‹•ï¼‰
agentmine session start --name auth-feature

# Web UIã‚’é–‹ã
agentmine session open  # ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000/sessions/xxx

# ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§
agentmine session list

# å…¥åŠ›é€ä¿¡ï¼ˆCLIã‹ã‚‰ã‚‚å¯èƒ½ï¼‰
agentmine session send shogun "èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦"

# ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†
agentmine session stop
```

### AI CLIè¨­å®š

å„å±¤ã§ä½¿ç”¨ã™ã‚‹AI CLIã¯è¨­å®šã§æŒ‡å®šå¯èƒ½ã€‚

```yaml
# .agentmine/config.yaml
session:
  processes:
    shogun:
      command: ["claude"]
      args: ["--context", ".agentmine/context/shogun.md"]
    planner:
      command: ["claude"]
      args: ["--task", "ã‚¿ã‚¹ã‚¯åˆ†è§£"]
    supervisor:
      command: ["claude"]
      args: ["--task", "ç›£è¦–ãƒ«ãƒ¼ãƒ—"]
    worker:
      command: ["claude"]
      args: ["--dangerously-skip-permissions"]
    reviewer:
      command: ["claude"]
      args: ["--task", "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼"]
```

### OSå¯¾å¿œ

| OS | å¯¾å¿œæ–¹æ³• |
|----|---------|
| Linux | Node.js child_processï¼ˆspawnï¼‰ |
| macOS | Node.js child_processï¼ˆspawnï¼‰ |
| Windows | Node.js child_processï¼ˆspawnï¼‰ |
| WSL2 | Node.js child_processï¼ˆspawnï¼‰ |

Node.jsã®`child_process.spawn`ã¯ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å‹•ä½œã™ã‚‹ã€‚

## çµæœ

### ãƒã‚¸ãƒ†ã‚£ãƒ–ãªå½±éŸ¿

- OSéä¾å­˜ï¼ˆWindows nativeå¯¾å¿œï¼‰
- ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒªãƒƒãƒãªå¯è¦–åŒ–
- ãƒªãƒ¢ãƒ¼ãƒˆã‹ã‚‰ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- AgentMineã«çµ±åˆï¼ˆå˜ä¸€ã‚·ã‚¹ãƒ†ãƒ ï¼‰
- ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ã¨çµ±åˆè¡¨ç¤º

### ãƒã‚¬ãƒ†ã‚£ãƒ–ãªå½±éŸ¿

- ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ç›´æ¥æ“ä½œã®å–ªå¤±ï¼ˆtmuxã®ã‚ˆã†ãªæŸ”è»Ÿæ€§ï¼‰
- WebSocketå®Ÿè£…ã‚³ã‚¹ãƒˆ
- ãƒ–ãƒ©ã‚¦ã‚¶å¿…é ˆï¼ˆãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹é‹ç”¨ã§ã¯ä¸è¦ã ãŒï¼‰

### å°†æ¥ã®æ‹¡å¼µ

- tmuxä½µç”¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆå¥½ã¿ã§é¸æŠï¼‰
- SSHçµŒç”±ã®ãƒªãƒ¢ãƒ¼ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³
- ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œUI
- éŸ³å£°å…¥åŠ›å¯¾å¿œ

## å®Ÿè£…è¨ˆç”»

### Phase 1: ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†åŸºç›¤

- `ProcessManager` ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
- åŸºæœ¬çš„ãªspawn/kill/output

### Phase 2: WebSocketé…ä¿¡

- WebSocketã‚µãƒ¼ãƒãƒ¼å®Ÿè£…
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡ºåŠ›é…ä¿¡

### Phase 3: Web UI

- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”»é¢å®Ÿè£…
- å„å±¤ã®ã‚¿ãƒ–è¡¨ç¤º
- å‡ºåŠ›ã‚¹ãƒˆãƒªãƒ¼ãƒ è¡¨ç¤º
- å…¥åŠ›é€ä¿¡

### Phase 4: çµ±åˆ

- ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ã¨ã®é€£æº
- å„å±¤ã®è‡ªå‹•èµ·å‹•ãƒ•ãƒ­ãƒ¼

## é–¢é€£ADR

- [ADR-007](./007-five-layer-architecture.md) - 5å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- [ADR-005](./005-ai-agnostic-orchestration.md) - AIéä¾å­˜è¨­è¨ˆ

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Web UI](../06-interfaces/web/overview.md) - Web UIè¨­è¨ˆ
